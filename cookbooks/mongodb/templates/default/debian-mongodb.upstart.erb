# Ubuntu upstart file at /etc/init/<% @provides %>.conf
# Automatically Generated by Chef

<%- node['mongodb']['ulimit'].to_hash.keys.sort.each do |key| %>
    <%- if not node['mongodb']['ulimit'][key].nil? %>
limit <%= key %> <%= node['mongodb']['ulimit'][key] %> <%= node['mongodb']['ulimit'][key] %>
    <% end %>
<%- end %>

kill timeout 300 # wait 300s between SIGTERM and SIGKILL.

start on runlevel [2345]
stop on runlevel [06]

script
  NAME=<%= @provides %>
  ENABLE_MONGODB="yes"
  if [ -f <%= node['mongodb']['sysconfig_file'] %> ]; then
    . <%= node['mongodb']['sysconfig_file'] %>;
  fi
  if [ "x$ENABLE_MONGOD" = "xyes" ]; then
  exec start-stop-daemon --start --quiet --chuid $DAEMON_USER --exec $DAEMON -- $DAEMON_OPTS
  fi
end script
